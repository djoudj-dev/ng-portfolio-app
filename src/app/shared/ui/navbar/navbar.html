<nav
  appClickOutside
  [isEnabled]="isMobileMenuOpen()"
  (clickOutside)="onCloseMobileMenu()"
  [class.nav-scrolled]="isScrolled()"
  class="fixed top-0 z-50 flex justify-center w-full px-4 pt-6 transition-all duration-300"
  role="navigation"
  aria-label="Navigation principale"
>
  <div
    class="relative flex w-full max-w-6xl flex-nowrap items-center justify-between gap-3 rounded-full border-2 border-primary/40 px-4 py-3 shadow-lg shadow-primary/20 backdrop-blur-md sm:px-6 sm:py-3"
  >
    <!-- Logo / Marque -->
    <a
      [routerLink]="['/']"
      class="inline-flex items-center gap-2 text-base font-bold tracking-tight text-text transition hover:opacity-90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/45 focus-visible:ring-offset-2 focus-visible:ring-offset-background sm:text-lg lg:text-xl flex-shrink-0"
    >
      <span
        class="inline-flex items-center justify-center h-10 w-10 rounded-full border border-primary bg-background/60 text-text"
      >
        <app-svg-icon name="lucide:code-xml" [width]="'24'" [height]="'24'" />
      </span>
    </a>

    <!-- Liens de navigation principaux -->
    <div
      class="absolute left-1/2 -translate-x-1/2 hidden lg:flex items-center divide-x divide-primary/20 rounded-full bg-transparent"
    >
      @for (link of navLinks(); track link.route) {
        <a
          class="inline-flex items-center gap-2 px-3 py-1 text-base font-medium text-text transition-transform duration-150 hover:-translate-y-0.5 hover:text-accent focus-visible:outline-none h-11 relative group"
          [routerLink]="link.route"
          [class.text-accent]="isActiveRoute(link.route)"
          [attr.aria-current]="isActiveRoute(link.route) ? 'page' : null"
          [attr.tabindex]="link.label === 'Blog' ? 0 : null"
        >
          <span
            class="inline-flex items-center justify-center h-8 w-8 rounded-full bg-background/60 transition-shadow"
          >
            <app-svg-icon [name]="link.icon" [width]="'20'" [height]="'20'" />
          </span>
          <span
            class="whitespace-nowrap transition-all px-3 py-1 rounded-md shadow-sm"
            [class.bg-accent]="isActiveRoute(link.route)"
            [class.text-background]="isActiveRoute(link.route)"
            [class.bg-transparent]="!isActiveRoute(link.route) && link.label !== 'Blog'"
            [class.bg-secondary]="!isActiveRoute(link.route) && link.label === 'Blog'"
          >
            {{ link.label }}
          </span>
          <!-- Bulle d'info Blog, structure identique au bouton CV -->
          @if (link.label === 'Blog' && !isActiveRoute(link.route)) {
            <span
              class="absolute top-full left-1/2 -translate-x-1/2 mt-2 invisible opacity-0 scale-95 pointer-events-none transition-all duration-150 ease-out items-center whitespace-nowrap rounded-md bg-primary text-text px-3 py-1 text-sm shadow-md z-50 group-hover:visible group-hover:opacity-100 group-hover:pointer-events-auto group-hover:scale-100"
            >
              Bientôt disponible !
            </span>
          }
        </a>
      }
    </div>

    <!-- Zone droite (CV + menu mobile) -->
    <div class="ml-auto flex items-center gap-2">
      <!-- Bouton CV -->
      <button
        type="button"
        (click)="openCV()"
        class="relative inline-flex items-center group"
        aria-label="Voir mon CV"
      >
        <span
          class="inline-flex items-center justify-center h-10 w-10 rounded-full border border-primary bg-background/60 text-text transition-transform hover:scale-105"
        >
          <app-svg-icon name="lucide:download" [width]="'20'" [height]="'20'" />
        </span>

        <span
          class="absolute top-full left-1/2 -translate-x-1/2 mt-2 invisible opacity-0 scale-95 pointer-events-none transition-all duration-150 ease-out items-center whitespace-nowrap rounded-md bg-primary text-text px-3 py-1 text-sm shadow-md z-50 group-hover:visible group-hover:opacity-100 group-hover:pointer-events-auto group-hover:scale-100"
        >
          Télécharger mon CV
        </span>
      </button>

      <!-- Bouton menu mobile -->
      <button
        type="button"
        class="inline-flex h-10 w-10 items-center justify-center rounded-full border border-primary bg-background/60 text-text transition hover:scale-105 lg:hidden"
        aria-label="{{ isMobileMenuOpen() ? 'Fermer la navigation' : 'Ouvrir la navigation' }}"
        [attr.aria-expanded]="isMobileMenuOpen()"
        (click)="onToggleMobileMenu()"
      >
        <app-svg-icon
          [name]="isMobileMenuOpen() ? 'lucide:circle-x' : 'lucide:menu'"
          [width]="'20'"
          [height]="'20'"
        />
      </button>
    </div>

    <!-- Menu mobile -->
    <div
      class="absolute left-3 right-3 top-20 flex flex-col gap-3 rounded-3xl border-2 border-primary bg-background p-4 text-left shadow-md shadow-primary sm:p-5 lg:hidden"
      [class.hidden]="!isMobileMenuOpen()"
    >
      <!-- Liens de navigation mobile -->
      <div class="flex flex-col gap-2">
        @for (link of navLinks(); track link.route) {
          <a
            [routerLink]="link.route"
            class="group inline-flex items-center gap-3 px-3 py-2 text-sm font-medium text-text transition-colors hover:text-accent rounded-lg"
            [class.text-accent]="isActiveRoute(link.route)"
            (click)="onCloseMobileMenu()"
          >
            <span class="inline-flex items-center justify-center h-6 w-6">
              <app-svg-icon [name]="link.icon" [width]="'18'" [height]="'18'" />
            </span>
            <span>{{ link.label }}</span>
          </a>
        }
      </div>
    </div>
  </div>
</nav>
