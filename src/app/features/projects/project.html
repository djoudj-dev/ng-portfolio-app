<main id="projects" class="text-text pb-4 pt-20 sm:pb-8 sm:pt-20 md:pb-12 md:pt-24">
  <header
    class="sticky top-0 z-30 bg-background/95 backdrop-blur-lg border-b border-accent/20 mb-4 px-3 sm:mb-8 sm:px-6 md:mb-12 shadow-md"
  >
    <h1
      id="projects-heading"
      class="text-text decoration-accent mb-2 flex justify-center text-2xl font-bold underline decoration-2 underline-offset-4 sm:text-3xl sm:mb-3 md:text-4xl lg:text-5xl mt-[14px] sm:mt-5 lg:mt-8"
    >
      {{ projectTitle() }}
    </h1>
    <p
      class="text-text/80 mx-auto mb-3 max-w-2xl text-center text-sm px-2 leading-relaxed sm:text-base sm:mb-5 sm:px-0 md:text-lg"
    >
      {{ projectSubTitle() }}
    </p>
  </header>

  <div class="container mx-auto px-4">
    @defer (on viewport) {
      <app-project-search
        [searchQuery]="searchQuery()"
        [filters]="filters()"
        (searchChange)="onSearch($event)"
        (clearSearchEvent)="clearSearch()"
        (filterChange)="setFilter($event)"
      />
    } @placeholder {
      <section class="mb-8" aria-labelledby="search-filter-section">
        <h2 id="search-filter-section" class="sr-only">Recherche et filtres</h2>
        <div class="flex flex-col justify-center gap-4 sm:flex-row">
          <div class="relative w-full sm:w-72">
            <div
              class="bg-background text-text border-primary w-full rounded-lg border px-4 py-2 h-10 animate-pulse"
            ></div>
          </div>
        </div>
        <div class="mt-4 flex flex-wrap justify-center gap-2">
          <div class="bg-accent rounded px-3 py-1 text-sm w-16 h-8 animate-pulse"></div>
          <div class="bg-accent rounded px-3 py-1 text-sm w-20 h-8 animate-pulse"></div>
          <div class="bg-accent rounded px-3 py-1 text-sm w-18 h-8 animate-pulse"></div>
        </div>
      </section>
    }

    <section aria-labelledby="projects-list-section">
      <h2 id="projects-list-section" class="sr-only">Liste des projets</h2>

      @if (allProjects().length) {
        <div class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3">
          @for (project of allProjects(); track project.id) {
            <article
              class="rounded-2xl border border-primary/25 bg-gradient-to-br from-background/80 via-background/60 to-primary/10 p-4 shadow-lg shadow-primary/15 transition-all duration-300 hover:border-accent/40 hover:shadow-accent/30 hover:-translate-y-1"
              [class.opacity-50]="!isProjectHydrated(project.id)"
              [class.grayscale]="!isProjectHydrated(project.id)"
              (mouseenter)="hydrateProject(project.id)"
              (mouseleave)="dehydrateProject(project.id)"
              (focusin)="hydrateProject(project.id)"
              (focusout)="dehydrateProject(project.id)"
              (click)="hydrateProject(project.id)"
              tabindex="0"
              [attr.aria-label]="'Projet ' + project.title"
            >
              <header>
                <div class="relative mb-4 h-48 overflow-hidden rounded-xl">
                  <img
                    [ngSrc]="getProjectImageUrl(project.imagePath)"
                    [alt]="'Capture d ecran du projet ' + project.title"
                    [fill]="true"
                    priority
                    class="h-full w-full object-cover"
                  />
                  <div class="absolute top-2 right-2">
                    <span
                      class="inline-flex items-center border border-accent/40 rounded-xl bg-gradient-to-br from-accent/30 via-background/50 to-primary/20 px-2.5 py-1.5 text-xs font-semibold text-text uppercase tracking-150 shadow-lg shadow-primary/20"
                    >
                      {{ project.category }}
                    </span>
                  </div>
                </div>

                <div class="flex justify-between items-start mb-2">
                  <h3
                    class="text-primary/70 text-lg font-semibold uppercase tracking-250 sm:text-xl"
                  >
                    {{ project.title }}
                  </h3>
                  <div class="text-accent/60 text-xs font-semibold uppercase tracking-200 pt-2">
                    {{ project.date | date: 'dd/MM/yyyy' }}
                  </div>
                </div>
              </header>

              <p class="text-text/80 mb-4 text-sm">
                {{ project.description }}
              </p>

              <div class="mb-4 flex flex-wrap gap-2">
                @for (tech of project.technologies; track tech) {
                  @if (getTechnologyWithIcon(tech)) {
                    <span
                      class="border border-primary/25 rounded-xl bg-gradient-to-br from-background/85 via-background/60 to-primary/10 px-2 py-1 text-xs flex items-center gap-1.5 font-semibold text-primary/70 uppercase tracking-150"
                    >
                      <app-svg-icon
                        [name]="getTechnologyWithIcon(tech)!.icon"
                        [width]="'16'"
                        [height]="'16'"
                        class="w-4 h-4 icon-invert"
                      />
                      {{ tech }}
                    </span>
                  } @else {
                    <span
                      class="border border-primary/20 rounded-xl bg-gradient-to-br from-background/70 via-background/50 to-primary/5 px-2 py-1 text-xs font-semibold text-primary/60 uppercase tracking-150"
                    >
                      {{ tech }}
                    </span>
                  }
                }
              </div>

              <footer class="mt-4 flex justify-between">
                <div class="flex flex-wrap gap-2 sm:gap-2">
                  @for (link of getAllProjectLinks(project); track link.href) {
                    <a
                      [href]="link.href"
                      target="_blank"
                      rel="noopener noreferrer"
                      class="group inline-flex items-center gap-1.5 sm:gap-2 border border-accent/40 rounded-xl bg-gradient-to-br from-accent/30 via-background/50 to-primary/20 px-3 py-2 text-xs font-semibold text-text uppercase tracking-150 transition-all duration-300 hover:border-accent/60 hover:shadow-md hover:shadow-accent/25 hover:-translate-y-0.5 sm:px-4 sm:py-2.5 sm:text-sm"
                      [attr.aria-label]="link.ariaLabel"
                    >
                      <app-svg-icon
                        [name]="link.icon"
                        [width]="'16'"
                        [height]="'16'"
                        class="w-4 h-4 transition-transform group-hover:scale-110 duration-300"
                      />
                      {{ link.label }}
                    </a>
                  }
                </div>
              </footer>
            </article>
          }
        </div>

        @defer (on viewport; prefetch on idle) {
          <app-project-pagination
            [currentPage]="currentPage()"
            [totalPages]="totalPages()"
            (pageChange)="goToPage($event)"
          />
        } @placeholder {
          <div class="mt-8 flex items-center justify-center space-x-2">
            <div class="bg-accent rounded px-3 py-1 text-sm w-8 h-8 animate-pulse"></div>
            <div class="bg-accent rounded px-3 py-1 text-sm w-8 h-8 animate-pulse"></div>
            <div class="bg-accent rounded px-3 py-1 text-sm w-8 h-8 animate-pulse"></div>
            <div class="bg-accent rounded px-3 py-1 text-sm w-8 h-8 animate-pulse"></div>
          </div>
        }
      } @else {
        <div class="py-12 text-center">
          <p class="text-text/70 text-lg">Aucun projet ne correspond à votre recherche.</p>
          <button
            (click)="clearSearch(); setFilter('all')"
            class="text-accent mt-4 hover:underline"
          >
            Réinitialiser les filtres
          </button>
        </div>
      }
    </section>
  </div>
  <div class="fixed bottom-3 right-3 z-40 sm:bottom-6 sm:right-6 md:bottom-8 md:right-8">
    <button
      (click)="navigateToContact()"
      aria-label="Aller à la section Contact"
      title="Me contacter"
      class="group flex items-center gap-2 sm:gap-2.5 border border-primary/25 rounded-xl bg-gradient-to-br from-background/85 via-background/60 to-primary/10 hover:border-accent/40 hover:shadow-md hover:shadow-accent/25 p-2 sm:p-2.5 min-w-0 transition-all duration-300 cursor-pointer hover:-translate-y-0.5"
    >
      <span class="flex-shrink-0 transition-transform group-hover:scale-110 duration-300">
        <app-svg-icon
          [name]="'lucide:arrow-big-down'"
          [height]="'24'"
          [width]="'24'"
          class="h-5 w-5 sm:h-6 sm:w-6 text-text"
        />
      </span>
    </button>
  </div>
</main>
